<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
    <link rel="stylesheet" href="./css/register.css">
</head>
<style>
    body {
        width: 100%;
    }
</style>

<body>
    <div>
        <div class="a1">
            <div> <img src="./register_img/register-one.png" alt=""></div>
            <div>帮助</div>
        </div>
        <div class="b1">
            <img src="./register_img/logo.png" alt="">
        </div>
        <form action="">
            <div class="c1">
                <input type="text" placeholder="请输入手机号" id="ip1">
                <div id="t1"></div>
                <input type="text" placeholder="请输入验证码">
                <div></div>
                <input type="password" placeholder="请输入密码" id="ip2">
                <div id="t3"></div>
            </div>
            <div class="d1">
                <img src="./log_img/login-three.png" ontouchstart="f1()" alt="">
            </div>
        </form>
        <div class="h1" id="l1"></div>
        <div class="e1">
            注册即代表同意【迷音】服务条款和隐私条款
        </div>
    </div>
</body>
<script src="./js/jQuery.js"></script>
<script>
    //手机号验证
    $('#ip1').on('focus', function() {
        $(this).val('')
        $('#t1').css('color', '#fff')
        $('#t1').html('输入11位手机号')
    })
    $('#ip1').on('input', function() {
        var name1 = $(this).val();
        if (!(/^1[3456789]\d{9}$/.test(name1))) {
            $('#t1').css('color', 'red')
            $('#t1').html('手机号输入错误')

        } else {
            $('#t1').css('color', 'green')
            $('#t1').html('手机号输入正确')
        }
    })

    //密码验证
    $('#ip2').on('focus', function() {
        $(this).val('')
        $('#t1').css('color', '#fff')
        $('#t1').html('数字字母组合的4位数')
    })

    $('#ip2').on('input', function() {
        var psw = $(this).val()
        if (!(/^([a-zA-Z0-9]){4}$/.test(psw))) {
            $('#t3').css('color', 'red')
            $('#t3').html('密码错误,4位,数字字母组合')
        } else {
            $('#t3').css('color', 'green')
            $('#t3').html('密码正确')
        }
    })

    function f1() {
        var name = document.getElementsByTagName('input')[0].value;
        var psw = document.getElementsByTagName('input')[2].value;
        if (!(/^1[3456789]\d{9}$/.test(name))) {
            $('#t1').css('color', 'red')
            t1.innerHTML = '请输入正确的手机号';
            $('#ip2').val('')
            return false;
        }
        var url = "http://192.168.1.45:3000/users";
        var obj = {
            type: "register",
            phone: name,
            pass: psw
        }
        $.post(url, obj, function(data) {
            if (data.msg == '该手机号已经被注册') {
                $('#t1').css('color', 'red')
                $('#t1').html('手机号已被注册');
                $('#ip2').val('')
                $('#t3').html('')
                return false;
            }
            console.log(data)
            var sti = null;
            var i = 4
            sti = setInterval(function() {
                i = i - 1
                $('#l1').html('注册成功' + i + '秒后去登陆...')
            }, 1000);
            setTimeout(function() {
                // clearInterval(sti)
                window.location.href = 'login.html'
            }, 4800)
        });

    }


    (function() {
        var supportsOrientationChange = 'onorientationchange' in window ? 'orientationchange' : 'resize';
        var timeoutId;

        function setRem() {
            var clientWidth = document.documentElement.clientWidth;
            var nowPX = clientWidth / 750 * 1;
            document.documentElement.style.fontSize = nowPX + 'px';
        }
        setRem();
        window.addEventListener(supportsOrientationChange, function() {
            clearTimeout(timeoutId);
            timeoutId = setTimeout(function() {
                setRem();
            }, 300);
        }, false);
    })();
</script>

</html>